"use strict";
define( [
    'jquery',
    '../../../../bower_components/underscore/underscore',
    'backbone',
		'hbs!templates/instructorReviewDetail',
		'views/header',
		'models/instructor'
], function( $, _, Backbone, instructorReviewDetailTemplate, HeaderView, InstructorModel ) {
	var InstructorReviewDetailView = Backbone.View.extend( {

		render: function( instructorId, reviewId ) {

			var self = this;
			var data = {};

			_.each( window.app.instructorReviews, function( review ) {
				if ( review.id == reviewId ) {
					data = review;
				}
			} );

			var compiledTemplate = instructorReviewDetailTemplate( data );
			self.$el.html( compiledTemplate );

			var instructorModel = new InstructorModel( { 'id': instructorId } );
			instructorModel.fetch({

				success: function( model, response ) {

					var instructor = model.toJSON();
					self.$el.find( '.header-title' ).append( ( instructor.givenName || '' ) + ' ' + ( instructor.familyName || '' ) );

				},

				error: function( model, response ) {
					console.log('Could not get instructor details');
				}

			});
			var header = new HeaderView();

			header.render( {
				back: true,
				title: ' '
			} );

			self.$el.find( '#header' ).append( header.el );

			if( navigator.mixpanel ) {
				navigator.mixpanel.track(
					'Instructor viewed detail',
					{
						'Instructor': instructorId,
						'content': 'Review detail '
					},
					function(){ },
					function( message ) {
						console.log( message );
					}
				);
			}

			window.app.router.postRender( self );

			if( navigator.mixpanel ) {
				navigator.mixpanel.track(
					'Instructor viewed detail',
					{
						'Instructor': instructorId,
						'content': 'Review detail '
					},
					function(){ },
					function( message ) {
						console.log( message );
					}
				);
			}

		},

		back: function() {
			window.app.router.goBack();
		}

	} );

	return InstructorReviewDetailView;
} );

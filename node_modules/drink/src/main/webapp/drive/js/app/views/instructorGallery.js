define( [
    'jquery',
    '../../../../bower_components/underscore/underscore',
    'backbone',
		'i18next',
		'hbs!templates/instructorGallery',
		'views/header',
		'view'
], function( $, _, Backbone, i18next, instructorGalleryTemplate, HeaderView, viewGallery ) {
	var InstructorGalleryView = Backbone.View.extend( {
		//el: '#wrapper',

		render: function( data ) {

			var self = this;
			var params = data || {};
			params.deviceWidth = $( window ).width();
			var numImagesPerLine = 3;
			var imageWidth = Math.round( ( params.deviceWidth - ( ( 1 + numImagesPerLine ) * 20 ) ) / numImagesPerLine );

			params.gallery = [];
			_.each( params.images, function( v ) {
					_.each( v.image, function( imageSize ) {
						if ( imageSize.size == 370 ) {
							params.gallery.push( {
								url: imageSize.url,
								imageWidth: imageWidth
							} );
						}
					} );
			} );


			var compiledTemplate = instructorGalleryTemplate( params );
			this.$el.html( compiledTemplate );

			var header = new HeaderView();

			header.render( {
				back: true
			} );

			this.$el.find( '#header' ).append( header.el );

			if( navigator.mixpanel ) {
				navigator.mixpanel.track(
					'Instructor viewed detail',
					{
						'Instructor': params.id,
						'content': 'Gallery'
					},
					function(){ },
					function( message ) {
						console.log( message );
					}
				);
			}

			window.app.router.postRender( self );

			// start the gallery
			new View( $( '.view' ) );
		}

	} );

	return InstructorGalleryView;
} );

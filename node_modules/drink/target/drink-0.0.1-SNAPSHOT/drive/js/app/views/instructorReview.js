define( [
    'jquery',
    '../../../../bower_components/underscore/underscore',
    'backbone',
		'models/instructorReview',
		'hbs!templates/instructorReview',
		'views/instructorReviewDetail'
], function( $, _, Backbone, InstructorReviewModel, instructorReviewTemplate, InstructorReviewDetailView ) {
	var InstructorReviewView = Backbone.View.extend( {
		tagName: 'li',

		events:{
			'click .instructor-review-detail-view': 'fullReview',
			'click': 'fullReview'
		},

		render: function() {

			if( typeof analytics !== 'undefined' ){
				analytics.trackView( 'Instructor Review' );
			}

			var self = this;
			var params = this.model || {};

			params.stars = {
				max: 5,
				average: params.starRating
			};

			// truncate the text
			params.reviewBodyShort = params.reviewBody.substr( 0, 150 ) + '...';

			if ( _.isUndefined( window.app.instructorReviews ) ) {
				window.app.instructorReviews = [];
			}

			window.app.instructorReviews.push( params );
			params.instructor = this.instructor;

			var compiledTemplate = instructorReviewTemplate( params );
			//self.$el.addClass( 'topcoat-list__item' );
			self.$el.attr( 'id', 'instructorReview-' + this.model.id );

			self.$el.html( compiledTemplate );

			self.delegateEvents();

			return self;
		},

		fullReview: function( event ) {
			event.preventDefault();
			window.app.router.navigate( '/instructorReviewDetail/' + this.model.instructorId + '/' + this.model.id, true );
		},


	} );

	return InstructorReviewView;
} );

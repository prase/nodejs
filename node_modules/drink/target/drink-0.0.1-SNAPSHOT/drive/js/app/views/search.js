define( [
	'jquery',
	'../../../../bower_components/underscore/underscore',
	'backbone',
	'platform',
	'models/search',
	'hbs!templates/search'
], function( $, _, Backbone, Platform, SearchModel, searchTemplate ) {
	var SearchView = Backbone.View.extend( {

		tagName: 'li',

		events: {
			'click': 'selectSearch'
		},

		model: null,
		parentView: null,

		render: function( parentView ) {

			var self = this;
			self.parentView = parentView;
			var params = this.model.toJSON() || {};
			var compiledTemplate = searchTemplate( params );

			self.$el.html( compiledTemplate );
			self.delegateEvents();

			return self;
		},

		selectSearch: function( event ) {
			event.preventDefault();
			var self = this;
			var model = this.model.toJSON();

			if ( model.isTown ) {
				if ( Platform.platform == 'iOS' ) {
					// send parent lat long
					window.app.router.navigate( '/instructors/' + model.latitude + ',' + model.longitude, true );
				} else {
					// send parent lat long
					self.parentView.townSearch( model );
				}
			} else {
				// instructor
				window.app.router.navigate( '/instructorDetail/' + model.id, true );
			}
		}

	} );

	return SearchView;
} );

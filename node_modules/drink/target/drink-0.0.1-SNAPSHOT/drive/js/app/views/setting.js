define( [
    'jquery',
    '../../../../bower_components/underscore/underscore',
    'backbone',
		'hbs!templates/settingsSwitch'
], function( $, _, Backbone, settingSwitchTemplate ) {
	var SettingView = Backbone.View.extend( {
		tagName: 'div',

		events: {
			'click .sendSetting': 'sendSetting'
		},

		initialize: function(){
			this.render();
		},

		render: function() {

			var self = this;
			var params = this.model.toJSON() || {};
			var haveTemplate = false;
			var compiledTemplate = null;

			if ( !_.isUndefined( params.type ) ) {
				switch( params.type.toLowerCase() ) {
					case 'switch':
						compiledTemplate = settingSwitchTemplate( params );
						haveTemplate = true;
						break;

					default:
						haveTemplate = false;
						break;
				}
			}

			if ( haveTemplate ) {
				self.$el.html( compiledTemplate );
				self.delegateEvents();
			}

			return self;
		},

		sendSetting: function( event ) {
			event.preventDefault;
			var checkedValue = $( event.target ).is( ':checked' );

			// if setting changes then send
			var setting = this.model.toJSON();

			if ( setting.isEnabled != checkedValue ) {
				this.model.learnerId = setting.learnerId;
				this.model.save( 'isEnabled', checkedValue, {
					error: function( model, response, options ) {
						// TODO save for later

						console.log( 'error', model, response, options );
					}
				} );
			}
		}
	} );

	return SettingView;
} );

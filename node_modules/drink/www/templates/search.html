<ion-view view-title="Suche" id="content_search" class="transparentBackground">

  <ion-nav-title id="search-title-bar" class="searchbar">
		<ion-google-place ionplacecallback="searchByAddress()" ng-model="data.address"/>
  </ion-nav-title>
  <ion-nav-buttons side="right">
		<label class="toggle toggle-balanced toggle-icons">
		 <input type="checkbox" ng-model="data.showList" ng-change="changePanel()">
		   <div class="track">
		   	 <i class="icon ion-map tabswitcher-left"></i>
			 <i class="icon ion-document-text tabswitcher-right"></i>
			 <div class="handle"><i class="icon tabswitcher-handle" ng-class="{'ion-map' : !data.showList, 'ion-document-text' : data.showList}"></i></div>
		   </div>
		</label>
  </ion-nav-buttons>
  <ion-content scroll='false' padding='false' has-bouncing="false" class="transparentBackground">
  	
	<ion-slide-box on-slide-changed="slideHasChanged($index)" show-pager="false" on-drag="stopDrag($event)">
	<ion-slide>
		
		<!--<button id="locatorbutton" class="button icon ion-android-locate" ng-click="locateUser()"></button>-->
	  <!--<ion-footer-bar align-title="left" class="bar-light" id="searchInfoBar">
		
	  </ion-footer-bar>-->
	</ion-slide>
	<ion-slide class="listslide">
		<ion-scroll delegate-handle="listscroller" direction="y" zooming="false" id="listscroller" on-swipe-right="changePanel(0)">
		<ion-refresher
			pulling-text="Zum Aktualisieren ziehen..."
			on-refresh="reloadParkings()">
		</ion-refresher>
		<div class="parkingList list" ng-if="data.listAvailable">
			<div class="card" 
				ng-repeat="parking in ::data.parkings track by parking.id" 
				ng-click="openParkinfo(parking.id)">
			  <div class="item item-text-wrap smallParkInfo withRouting">
				<h2 class="parkTitle">{{::parking.title}}</h2>
				<ul>
					<li>
						<h5>Preis</h5>
						<span class="parkPrice">{{::parking.selected_price}} €</span>
					</li>
					<li>
						<div once-if="parking.carpark.dynamic_data.free_spots != '-' && parking.carpark.total_spots != ''">
							<h5>Kapazität</h5>
							<span class="parkFreeSpots">{{::parking.carpark.dynamic_data.free_spots}} / {{::parking.carpark.total_spots}}</span>
						</div>
						<div once-if="parking.carpark.dynamic_data.free_spots == '-' && parking.carpark.total_spots != ''">
							<h5>Gesamt</h5>
							<span class="parkFreeSpots">{{::parking.carpark.total_spots}}</span>
						</div>
						<div once-if="parking.carpark.dynamic_data.free_spots != '-' && parking.carpark.total_spots == ''">
							<h5>Frei</h5>
							<span class="parkFreeSpots">{{::parking.carpark.dynamic_data.free_spots}}</span>
						</div>
						<div ng-if="data.selectedParking.carpark.dynamic_data.free_spots == '-' && data.selectedParking.carpark.total_spots == ''">
							<h5>Frei</h5>
							<span class="parkFreeSpots">n.a.</span>
						</div>
					</li>
					<li>
						<h5>Entfernung</h5>
						<span class="parkDistance">{{::parking.distance}} km</span>
					</li>
				</ul>
				<button class="button pull-right routingButton" ng-click="sendToExternalRouter($event, parking.lat, parking.lng)"><img alt="navigationspfeil" src="./images/icons/icon_route_round-01.svg" height="46px" width="46px"/></button>
			  </div>
			</div>
			<div ng-show="data.parkings == null || data.parkings.length == 0">
				<div class="card">
					<div class="item item-text-wrap">
						Hier haben wir noch keine Parkhausdaten.<br>
						Aber unser Team arbeitet mit Hochdruck daran, noch mehr Städte in unser System  zu integrieren.
					</div>
				</div>
			</div>
		</div>
		<div ng-show="!data.listAvailable">
			<div class="card">
				<div class="item item-text-wrap">
					Daten werden geladen...
				</div>
			</div>
		</div>
	  
		</ion-scroll>
	 </ion-slide>
	</ion-slide-box>
  </ion-content>
  <ion-footer-bar align-title="center" class="bar-positive searchfooter hide-on-keyboard-open">
	
	<button class="button icon ion-refresh button_footer button_refresh" ng-click="loadParkingsHere()"></button>
	
	<!-- List View: -->
	<div class="title">
		<label ng-show="data.showList" class="toggle toggle-positive toggle-icons">
		 <input type="checkbox" ng-model="data.orderfilterindex" ng-change="orderResults()">
		   <div class="track">
			 <i class="icon own-icon-km tabswitcher-left"></i>
		   	 <i class="icon own-icon-euro tabswitcher-right"></i>
			 <div class="handle"><i class="icon tabswitcher-handle" ng-class="{'own-icon-km' : !data.orderfilterindex, 'own-icon-euro' : data.orderfilterindex}"></i></div>
		   </div>
		</label>
	</div>
	
	<div class="align_right">
		<i class="icon ion-clock"></i>
		<button class="button timeselector button_footer" ng-click="showTimeOptions()">
			{{timeFrames[data.timeFrameIndex].text}}
		</button>
	</div>
  </ion-footer-bar>
</ion-view>